<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture2/Shape/Deep.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font> <font color=Blue>-- only for presentation</font>
<font color=Blue>-- | Simple library for 2D shapes. Deep embedding.</font>
<u><font color="#804000">module</font></u> <font color=Green>Shape</font><font color="#800080">.</font><font color=Green>Deep</font>
  <font color="#808080">(</font>
  <font color=Blue>-- * Types</font>
    <font color=Green>Shape</font> <font color=Blue>-- abstract</font>
  <font color=Blue>-- * Constructor functions</font>
  <font color="#808080">,</font> empty<font color="#808080">,</font> disc<font color="#808080">,</font> square
  <font color=Blue>-- * Primitive combinators</font>
  <font color="#808080">,</font> transform<font color="#808080">,</font> translate
  <font color="#808080">,</font> union<font color="#808080">,</font> intersect<font color="#808080">,</font> invert
  <font color=Blue>-- * Run functions</font>
  <font color="#808080">,</font> inside
  <font color="#808080">)</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <font color=Green>Matrix</font>

<font color=Blue>-- | In a deep embedding our objects are represented by a datatype</font>
<font color=Blue>--   with constructors for each primitive operation.</font>
<font color=Blue>{-
From the lecture slides:

type Shape
-- Constructor functions
empty   :: Shape
disc    :: Shape
square  :: Shape
-- Combinators
translate :: Vec -&gt;   Shape -&gt; Shape
scale     :: Vec -&gt;   Shape -&gt; Shape
rotate    :: Angle -&gt; Shape -&gt; Shape
union     :: Shape -&gt; Shape -&gt; Shape
intersect :: Shape -&gt; Shape -&gt; Shape
difference:: Shape -&gt; Shape -&gt; Shape

Later scale, rotate, difference are derived 
from invert and transform:

invert    :: Shape -&gt; Shape
transform :: Matrix -&gt; Shape -&gt; Shape

-}</font>

<u><font color="#804000">data</font></u> <font color=Green>Shape</font> <u><font color="#804000">where</font></u>
  <font color=Blue>-- Constructor functions</font>
  <font color=Green>Empty</font>   <font color="#808080">::</font> <font color=Green>Shape</font>
  <font color=Green>Disc</font>    <font color="#808080">::</font> <font color=Green>Shape</font>
  <font color=Green>Square</font>  <font color="#808080">::</font> <font color=Green>Shape</font>
  <font color=Blue>-- Combinators</font>
  <font color=Green>Translate</font> <font color="#808080">::</font> <font color=Green>Vec</font> <font color="#808080">-&gt;</font>   <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
  <font color=Green>Transform</font> <font color="#808080">::</font> <font color=Green>Matrix</font><font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
  <font color=Green>Union</font>     <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
  <font color=Green>Intersect</font> <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
  <font color=Green>Invert</font>    <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>

<font color=Blue>{-
-- Shape without GADT syntax
data Shape = Empty | Disc | Square
           | Translate Vec Shape
           | Transform Matrix Shape
           | Union Shape Shape
           | Intersect Shape Shape
           | Invert Shape
-}</font>

<font color=Blue>-- * Creation functions</font>

empty  <font color="#808080">::</font> <font color=Green>Shape</font>
empty  <font color="#808080">=</font> <font color=Green>Empty</font>

disc   <font color="#808080">::</font> <font color=Green>Shape</font>
disc   <font color="#808080">=</font> <font color=Green>Disc</font>  

square <font color="#808080">::</font> <font color=Green>Shape</font>
square <font color="#808080">=</font> <font color=Green>Square</font>

<font color=Blue>-- * Primitive combinators</font>

transform <font color="#808080">::</font> <font color=Green>Matrix</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
transform <font color="#808080">=</font> <font color=Green>Transform</font>

translate <font color="#808080">::</font> <font color=Green>Vec</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
translate <font color="#808080">=</font> <font color=Green>Translate</font>

union <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
union <font color="#808080">=</font> <font color=Green>Union</font>

intersect <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
intersect <font color="#808080">=</font> <font color=Green>Intersect</font>

invert <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
invert <font color="#808080">=</font> <font color=Green>Invert</font>

<font color=Blue>-- * Run function</font>

inside <font color="#808080">::</font> <font color=Green>Point</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
<b><font color=Magenta>_p</font></b> <font color="#800080">`inside`</font> <font color=Green>Empty</font>             <font color="#808080">=</font> <font color=Green>False</font>
p  <font color="#800080">`inside`</font> <font color=Green>Disc</font>              <font color="#808080">=</font> sqDistance p <font color="#800080">&lt;=</font> <font color=Magenta>1</font>
p  <font color="#800080">`inside`</font> <font color=Green>Square</font>            <font color="#808080">=</font> maxnorm  p <font color="#800080">&lt;=</font> <font color=Magenta>1</font>
p  <font color="#800080">`inside`</font> <font color=Green>Translate</font> v sh    <font color="#808080">=</font> <font color="#808080">(</font>p <font color="#800080">`sub`</font> v<font color="#808080">)</font> <font color="#800080">`inside`</font> sh
p  <font color="#800080">`inside`</font> <font color=Green>Transform</font> m sh    <font color="#808080">=</font> <font color="#808080">(</font>inv m <font color="#800080">`mul`</font> p<font color="#808080">)</font> <font color="#800080">`inside`</font> sh
p  <font color="#800080">`inside`</font> <font color=Green>Union</font> sh1 sh2     <font color="#808080">=</font> p <font color="#800080">`inside`</font> sh1 <font color="#800080">||</font> p <font color="#800080">`inside`</font> sh2
p  <font color="#800080">`inside`</font> <font color=Green>Intersect</font> sh1 sh2 <font color="#808080">=</font> p <font color="#800080">`inside`</font> sh1 <font color="#800080">&amp;&amp;</font> p <font color="#800080">`inside`</font> sh2
p  <font color="#800080">`inside`</font> <font color=Green>Invert</font> sh         <font color="#808080">=</font> not <font color="#808080">(</font>p <font color="#800080">`inside`</font> sh<font color="#808080">)</font>

<font color=Blue>-- * Helper functions</font>

sqDistance <font color="#808080">::</font> <font color=Green>Point</font> <font color="#808080">-&gt;</font> <font color=Green>Double</font>
sqDistance p <font color="#808080">=</font> x<font color="#800080">*</font>x<font color="#800080">+</font>y<font color="#800080">*</font>y <font color=Blue>-- proper distance would use sqrt</font>
  <u><font color="#804000">where</font></u> x <font color="#808080">=</font> ptX p
        y <font color="#808080">=</font> ptY p

maxnorm <font color="#808080">::</font> <font color=Green>Point</font> <font color="#808080">-&gt;</font> <font color=Green>Double</font>
maxnorm p <font color="#808080">=</font> max <font color="#808080">(</font>abs x<font color="#808080">)</font> <font color="#808080">(</font>abs y<font color="#808080">)</font>
  <u><font color="#804000">where</font></u> x <font color="#808080">=</font> ptX p
        y <font color="#808080">=</font> ptY p

<font color=Blue>-- | More reading: <a href="http://en.wikipedia.org/wiki/Norm_%28mathematics%29#Properties">http://en.wikipedia.org/wiki/Norm_%28mathematics%29#Properties</a></font>
</pre>
</body>
</html>