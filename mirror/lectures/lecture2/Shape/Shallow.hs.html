<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture2/Shape/Shallow.hs</title>
</head>
<body>
<pre><font color=Blue>-- | Simple library for 2D shapes. Shallow embedding.</font>
<u><font color="#804000">module</font></u> <font color=Green>Shape</font><font color="#800080">.</font><font color=Green>Shallow</font>
  <font color="#808080">(</font>
  <font color=Blue>-- * Types</font>
    <font color=Green>Shape</font> <font color=Blue>-- abstract</font>
  <font color=Blue>-- * Constructor functions</font>
  <font color="#808080">,</font> empty<font color="#808080">,</font> disc<font color="#808080">,</font> square
  <font color=Blue>-- * Primitive combinators</font>
  <font color="#808080">,</font> transform<font color="#808080">,</font> translate
  <font color="#808080">,</font> union<font color="#808080">,</font> intersect<font color="#808080">,</font> invert
  <font color=Blue>-- * Run functions</font>
  <font color="#808080">,</font> inside
  <font color="#808080">)</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <font color=Green>Matrix</font>

<u><font color="#804000">newtype</font></u> <font color=Green>Shape</font> <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#808080">(</font><font color=Green>Point</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font>

<font color=Blue>-- * Creation functions</font>

empty <font color="#808080">::</font> <font color=Green>Shape</font>
empty <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font><u><font color="#804000">_</font></u> <font color="#808080">-&gt;</font> <font color=Green>False</font>

disc <font color="#808080">::</font> <font color=Green>Shape</font>
disc <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> ptX p <font color="#800080">^</font> <font color=Magenta>2</font> <font color="#800080">+</font> ptY p <font color="#800080">^</font> <font color=Magenta>2</font> <font color="#800080">&lt;=</font> <font color=Magenta>1</font>

square <font color="#808080">::</font> <font color=Green>Shape</font>
square <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> abs <font color="#808080">(</font>ptX p<font color="#808080">)</font> <font color="#800080">&lt;=</font> <font color=Magenta>1</font> <font color="#800080">&amp;&amp;</font> abs <font color="#808080">(</font>ptY p<font color="#808080">)</font> <font color="#800080">&lt;=</font> <font color=Magenta>1</font>

<font color=Blue>-- * Primitive combinators</font>

<font color=Blue>-- | Transform a shape with a matrix.</font>
transform <font color="#808080">::</font> <font color=Green>Matrix</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
transform m sh <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> <font color="#808080">(</font>m' <font color="#800080">`mul`</font> p<font color="#808080">)</font> <font color="#800080">`inside`</font> sh
  <u><font color="#804000">where</font></u> m' <font color="#808080">=</font> inv m  <font color=Blue>-- the point is transformed with the inverse matrix</font>

<font color=Blue>-- | To represent translations as matrix transformations we would need</font>
<font color=Blue>--   to add another dimension to the matrices (excercise).</font>
translate <font color="#808080">::</font> <font color=Green>Vec</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
translate v sh <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> inside <font color="#808080">(</font>p <font color="#800080">`sub`</font> v<font color="#808080">)</font> sh

union <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
union sh1 sh2 <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> inside p sh1 <font color="#800080">||</font> inside p sh2

intersect <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
intersect sh1 sh2 <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> inside p sh1 <font color="#800080">&amp;&amp;</font> inside p sh2

invert <font color="#808080">::</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font>
invert sh <font color="#808080">=</font> <font color=Green>Shape</font> <font color="#800080">$</font> <font color="#808080">\</font>p <font color="#808080">-&gt;</font> not <font color="#808080">(</font>inside p sh<font color="#808080">)</font>

<font color=Blue>-- * Run function</font>

inside <font color="#808080">::</font> <font color=Green>Point</font> <font color="#808080">-&gt;</font> <font color=Green>Shape</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
p <font color="#800080">`inside`</font> <font color=Green>Shape</font> sh <font color="#808080">=</font> sh p
</pre>
</body>
</html>