<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture3/Snake.hs</title>
</head>
<body>
<pre><font color=Blue>{-
  A simple single player snake game.
-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Snake</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <font color=Green>ANSI</font>    <font color="#808080">(</font>ansiGoto<font color="#808080">,</font> ansiColour<font color="#808080">,</font> <font color=Green>Colour</font><font color="#808080">(</font><font color="#808080">..</font><font color="#808080">)</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Program</font> <font color="#808080">(</font><font color=Green>Program</font><font color="#808080">,</font> putS<font color="#808080">,</font> getC<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Game</font>    <font color="#808080">(</font>runGame<font color="#808080">,</font> <font color=Green>Game</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Coord</font>   <font color="#808080">(</font><font color=Green>Coord</font><font color="#808080">,</font> <font color=Green>Dir</font><font color="#808080">(</font><font color="#808080">..</font><font color="#808080">)</font><font color="#808080">,</font> outOfBounds<font color="#808080">,</font> movePos<font color="#808080">)</font>

<font color=Blue>-- | A snake is a list of body coord.s and a dir. of travel.</font>
<u><font color="#804000">data</font></u> <font color=Green>Snake</font> <font color="#808080">=</font> <font color=Green>Snake</font> <font color="#808080">{</font> pos <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Coord</font><font color="#808080">]</font>
                   <font color="#808080">,</font> dir <font color="#808080">::</font> <font color=Green>Dir</font>
                   <font color="#808080">}</font>

<font color=Blue>-- | The starting position of the snake.</font>
startingSnake <font color="#808080">::</font> <font color=Green>Snake</font>
startingSnake <font color="#808080">=</font> <font color=Green>Snake</font> <font color="#808080">(</font><font color="#808080">(</font><font color=Magenta>11</font><font color="#808080">,</font><font color=Magenta>10</font><font color="#808080">)</font> <b><font color="#800080">:</font></b> replicate <font color=Magenta>20</font> <font color="#808080">(</font><font color=Magenta>10</font><font color="#808080">,</font><font color=Magenta>10</font><font color="#808080">)</font><font color="#808080">)</font> <font color=Green>East</font>

<font color=Blue>-- | Check if a snake has collided with itself.</font>
collision <font color="#808080">::</font> <font color=Green>Snake</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
collision g <font color="#808080">=</font> <u><font color="#804000">case</font></u> pos g <u><font color="#804000">of</font></u>
  <font color=Green>[]</font>      <font color="#808080">-&gt;</font> <font color=Green>False</font>
  p <b><font color="#800080">:</font></b> ps  <font color="#808080">-&gt;</font> outOfBounds p  <font color="#800080">||</font>  p <font color="#800080">`elem`</font> ps

<font color=Blue>-- | Output a string at a given coordinate (uses some ANSI magic).</font>
putStrAt <font color="#808080">::</font> <font color=Green>Coord</font> <font color="#808080">-&gt;</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Program</font> <font color=Green>()</font>
putStrAt p s <font color="#808080">=</font> putS <font color="#800080">$</font> gotoPos p <font color="#800080">++</font> s
  <u><font color="#804000">where</font></u>
    gotoPos <font color="#808080">(</font>x<font color="#808080">,</font> y<font color="#808080">)</font> <font color="#808080">=</font> ansiGoto <font color="#808080">(</font>x <font color="#800080">*</font> <font color=Magenta>2</font> <font color="#800080">+</font> <font color=Magenta>1</font><font color="#808080">)</font> <font color="#808080">(</font>y <font color="#800080">+</font> <font color=Magenta>1</font><font color="#808080">)</font>

<font color=Blue>-- | Draw the snake. The last part of the tail is erased.</font>
drawSnake <font color="#808080">::</font> <font color=Green>Colour</font> <font color="#808080">-&gt;</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Snake</font> <font color="#808080">-&gt;</font> <font color=Green>Program</font> <font color=Green>()</font>
drawSnake col px s <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  <u><font color="#804000">let</font></u> ps <font color="#808080">=</font> pos s
  putStrAt <font color="#808080">(</font>last ps<font color="#808080">)</font> <font color=Magenta>"  "</font>                 <font color=Blue>-- erase previous tail</font>
  putStrAt <font color="#808080">(</font>head ps<font color="#808080">)</font> <font color="#800080">$</font> ansiColour col px  <font color=Blue>-- print new head</font>

<font color=Blue>-- | The different actions that the player can take.</font>
<u><font color="#804000">data</font></u> <font color=Green>Action</font> <font color="#808080">=</font> <font color=Green>Turn</font> <font color=Green>Dir</font> <font color="#808080">|</font> <font color=Green>Exit</font> <u><font color="#804000">deriving</font></u> <font color=Green>Show</font>

<font color=Blue>-- | Keyboard controls. Binds keys to actions.</font>
controls <font color="#808080">::</font> <font color="#808080">[</font><font color="#808080">(</font><font color=Green>Char</font><font color="#808080">,</font> <font color=Green>Action</font><font color="#808080">)</font><font color="#808080">]</font>
controls <font color="#808080">=</font>
  zip <font color=Magenta>"wasd"</font> <font color="#808080">(</font>map <font color=Green>Turn</font> <font color="#808080">[</font><font color=Green>North</font><font color="#808080">,</font> <font color=Green>West</font><font color="#808080">,</font> <font color=Green>South</font><font color="#808080">,</font> <font color=Green>East</font><font color="#808080">]</font><font color="#808080">)</font> <font color="#800080">++</font>
  <font color="#808080">[</font> <font color="#808080">(</font><font color=Magenta>'q'</font><font color="#808080">,</font> <font color=Green>Exit</font><font color="#808080">)</font><font color="#808080">,</font> <font color="#808080">(</font><font color=Magenta>'\ESC'</font><font color="#808080">,</font> <font color=Green>Exit</font><font color="#808080">)</font> <font color="#808080">]</font>

<font color=Blue>-- | One step of the actual game</font>
snake <font color="#808080">::</font> <font color=Green>Game</font> <font color=Green>Snake</font>
snake g 
  <font color="#808080">|</font> collision g <font color="#808080">=</font> <u><font color="#804000">do</font></u>
      putStrAt <font color="#808080">(</font><font color=Magenta>5</font><font color="#808080">,</font> <font color=Magenta>7</font><font color="#808080">)</font> <font color=Magenta>"Game Over!"</font>
      stop
  <font color="#808080">|</font> otherwise <font color="#808080">=</font> <u><font color="#804000">do</font></u>
      drawSnake <font color=Green>Yellow</font>  <font color=Magenta>"()"</font> g
      putStrAt <font color="#808080">(</font><font color=Magenta>0</font><font color="#808080">,</font><font color=Magenta>0</font><font color="#808080">)</font> <font color=Magenta>""</font>
      mc <font color="#808080">&lt;-</font> getC
      <u><font color="#804000">case</font></u> mc <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>c <font color="#808080">-&gt;</font> lookup c controls <u><font color="#804000">of</font></u>  <font color=Blue>-- Maybe is a monad</font>
        <font color=Green>Nothing</font>       <font color="#808080">-&gt;</font> continue_
        <font color=Green>Just</font> <font color="#808080">(</font><font color=Green>Turn</font> d<font color="#808080">)</font> <font color="#808080">-&gt;</font> continue d
        <font color=Green>Just</font> <font color=Green>Exit</font>     <font color="#808080">-&gt;</font> stop
  <u><font color="#804000">where</font></u>
    <font color=Blue>-- Moving the snake means adding a new head and removing </font>
    <font color=Blue>-- the last element of the tail.</font>
    move <font color="#808080">(</font>p<b><font color="#800080">:</font></b>ps<font color="#808080">)</font> d <font color="#808080">=</font> movePos p d <b><font color="#800080">:</font></b> p <b><font color="#800080">:</font></b> init ps

    stop          <font color="#808080">=</font> return <font color=Green>Nothing</font>
    continue_     <font color="#808080">=</font> continue <font color="#808080">(</font>dir g<font color="#808080">)</font>
    continue d    <font color="#808080">=</font> return <font color="#800080">$</font> <font color=Green>Just</font> <font color="#800080">$</font> g <font color="#808080">{</font> pos <font color="#808080">=</font> move <font color="#808080">(</font>pos g<font color="#808080">)</font> d
                                      <font color="#808080">,</font> dir <font color="#808080">=</font> d <font color="#808080">}</font>
</pre>
</body>
</html>