<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture3/Program/Shallow.hs</title>
</head>
<body>
<pre><font color=Blue>{-|
  A simple embedded language for input/output. Shallow embedding.
-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Program</font><font color="#800080">.</font><font color=Green>Shallow</font>
  <font color="#808080">(</font> <font color=Green>Input</font><font color="#808080">,</font> <font color=Green>Output</font>
  <font color="#808080">,</font> <font color=Green>Program</font>
  <font color="#808080">,</font> putC<font color="#808080">,</font> getC
  <font color="#808080">,</font> run
  <font color="#808080">)</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">type</font></u> <font color=Green>Input</font>  <font color="#808080">=</font> <font color=Green>String</font>
<u><font color="#804000">type</font></u> <font color=Green>Output</font> <font color="#808080">=</font> <font color=Green>String</font>

<font color=Blue>-- | Shallow embedding: programs are represented by their semantics</font>
<font color=Blue>--   In this case a program is a function from the input to the </font>
<font color=Blue>--   result, the remaining input and the output.</font>
<u><font color="#804000">type</font></u> <font color=Green>IOSem</font> a <font color="#808080">=</font> <font color=Green>Input</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font>a<font color="#808080">,</font> <font color=Green>Input</font><font color="#808080">,</font> <font color=Green>Output</font><font color="#808080">)</font>
<u><font color="#804000">newtype</font></u> <font color=Green>Program</font> a <font color="#808080">=</font> <font color=Green>P</font> <font color="#808080">{</font> unP <font color="#808080">::</font> <font color=Green>IOSem</font> a <font color="#808080">}</font>

<font color=Blue>-- | Print a character.</font>
putC <font color="#808080">::</font> <font color=Green>Char</font> <font color="#808080">-&gt;</font> <font color=Green>Program</font> <font color=Green>()</font>
putC c <font color="#808080">=</font> <font color=Green>P</font> <font color="#800080">$</font> <font color="#808080">\</font>i <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>()</font><font color="#808080">,</font> i<font color="#808080">,</font> <font color="#808080">[</font>c<font color="#808080">]</font><font color="#808080">)</font>

<font color=Blue>-- | Read a character (if there is one).</font>
getC <font color="#808080">::</font> <font color=Green>Program</font> <font color="#808080">(</font><font color=Green>Maybe</font> <font color=Green>Char</font><font color="#808080">)</font>
getC <font color="#808080">=</font> <font color=Green>P</font> <font color="#800080">$</font> <font color="#808080">\</font>i <font color="#808080">-&gt;</font> <u><font color="#804000">case</font></u> i <u><font color="#804000">of</font></u>
  <font color=Green>[]</font>     <font color="#808080">-&gt;</font>  <font color="#808080">(</font><font color=Green>Nothing</font><font color="#808080">,</font>  <font color=Green>[]</font><font color="#808080">,</font>  <font color=Green>[]</font><font color="#808080">)</font>
  c <b><font color="#800080">:</font></b> i' <font color="#808080">-&gt;</font>  <font color="#808080">(</font><font color=Green>Just</font> c<font color="#808080">,</font>   i'<font color="#808080">,</font>  <font color=Green>[]</font><font color="#808080">)</font>

<font color=Blue>-- Program is a monad, which provides us with a nice interface for</font>
<font color=Blue>-- sequencing programs.</font>
<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> <font color=Green>Program</font> <u><font color="#804000">where</font></u>
  return  <font color="#808080">=</font> returnP
  <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>   <font color="#808080">=</font> bindP

returnP <font color="#808080">::</font> a <font color="#808080">-&gt;</font> <font color=Green>Program</font> a
returnP x <font color="#808080">=</font> <font color=Green>P</font> <font color="#800080">$</font> <font color="#808080">\</font>i <font color="#808080">-&gt;</font> <font color="#808080">(</font>x<font color="#808080">,</font> i<font color="#808080">,</font> <font color=Green>[]</font><font color="#808080">)</font>

bindP <font color="#808080">::</font> <font color=Green>Program</font> a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>Program</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Program</font> b
bindP p k <font color="#808080">=</font> <font color=Green>P</font> <font color="#800080">$</font> <font color="#808080">\</font>i <font color="#808080">-&gt;</font>
    <u><font color="#804000">let</font></u>  <font color="#808080">(</font>x<font color="#808080">,</font>  i1<font color="#808080">,</font>  o1<font color="#808080">)</font>  <font color="#808080">=</font>  unP  p      i
         <font color="#808080">(</font>y<font color="#808080">,</font>  i2<font color="#808080">,</font>  o2<font color="#808080">)</font>  <font color="#808080">=</font>  unP  <font color="#808080">(</font>k x<font color="#808080">)</font>  i1
    <u><font color="#804000">in</font></u>   <font color="#808080">(</font>y<font color="#808080">,</font>  i2<font color="#808080">,</font>  o1 <font color="#800080">++</font> o2<font color="#808080">)</font>

<font color=Blue>-- | Running a program is simply returning its semantics.</font>
run <font color="#808080">::</font> <font color=Green>Program</font> a <font color="#808080">-&gt;</font> <font color=Green>IOSem</font> a
run <font color="#808080">=</font> unP

</pre>
</body>
</html>