<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture5/Interpreter0.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GeneralizedNewtypeDeriving #-}</font>
<font color=Blue>-- | Version 0 of the interpreter</font>
<u><font color="#804000">module</font></u> <font color=Green>Interpreter0</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font>          <u><font color="#804000">as</font></u> <font color=Green>CM</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Identity</font> <u><font color="#804000">as</font></u> <font color=Green>CMI</font>

<font color=Blue>-- | The simplest expression language imaginable.</font>
<u><font color="#804000">data</font></u> <font color=Green>Expr</font> <font color="#808080">=</font> <font color=Green>Lit</font> <font color=Green>Integer</font>
          <font color="#808080">|</font> <font color=Green>Expr</font> <b><font color="#800080">:+</font></b> <font color=Green>Expr</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Show</font><font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Value</font> <font color="#808080">=</font> <font color=Green>Integer</font>

<font color=Blue>{- | A monad for evaluating expressions. Just the identity monad
   at this point. Newtyped for abstraction purposes, could just
   as well be @type Eval = Identity@
-}</font>
<u><font color="#804000">newtype</font></u> <font color=Green>Eval</font> a <font color="#808080">=</font> <font color=Green>Eval</font> <font color="#808080">{</font> unEval <font color="#808080">::</font> <font color=Green>CMI</font><font color="#800080">.</font><font color=Green>Identity</font> a <font color="#808080">}</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Monad</font><font color="#808080">)</font> <font color=Blue>-- using newtype deriving (Haskell extension)</font>

runEval <font color="#808080">::</font> <font color=Green>Eval</font> a <font color="#808080">-&gt;</font> a
runEval <font color="#808080">=</font> <font color=Green>CMI</font><font color="#800080">.</font>runIdentity
        <font color="#800080">.</font> unEval

<font color=Blue>-- | A monadic evaluator.</font>
eval <font color="#808080">::</font> <font color=Green>Expr</font>  <font color="#808080">-&gt;</font> <font color=Green>Eval</font> <font color=Green>Value</font>
eval <font color="#808080">(</font><font color=Green>Lit</font> n<font color="#808080">)</font>   <font color="#808080">=</font> return n
eval <font color="#808080">(</font>a <b><font color="#800080">:+</font></b> b<font color="#808080">)</font>  <font color="#808080">=</font> <font color=Green>CM</font><font color="#800080">.</font>liftM2 <font color="#808080">(</font><font color="#800080">+</font><font color="#808080">)</font> <font color="#808080">(</font>eval a<font color="#808080">)</font> <font color="#808080">(</font>eval b<font color="#808080">)</font>

testExpr <font color="#808080">=</font> <font color=Green>Lit</font> <font color=Magenta>1700</font>  <b><font color="#800080">:+</font></b>   <font color=Green>Lit</font> <font color=Magenta>38</font>
test <font color="#808080">=</font> runEval <font color="#800080">$</font> eval testExpr
</pre>
</body>
</html>