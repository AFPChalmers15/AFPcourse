<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture5/Examples.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE FlexibleContexts #-}</font>
<u><font color="#804000">module</font></u> <font color=Green>Examples</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Reader</font>   <u><font color="#804000">as</font></u> <font color=Green>CMR</font> <font color="#808080">(</font><font color=Green>MonadReader</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>State</font>    <u><font color="#804000">as</font></u> <font color=Green>CMS</font> <font color="#808080">(</font><font color=Green>MonadState</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Error</font>    <u><font color="#804000">as</font></u> <font color=Green>CME</font> <font color="#808080">(</font><font color=Green>MonadError</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Interpreter4</font>

run <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>Either</font> <font color=Green>Err</font> <font color=Green>Integer</font>
run s <font color="#808080">=</font> runEval1 <font color="#800080">$</font> eval <font color="#800080">$</font> parse s

examplePrograms <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>String</font><font color="#808080">]</font>
examplePrograms <font color="#808080">=</font>
  <font color="#808080">[</font> <font color=Magenta>"1700+38"</font>
  <font color="#808080">,</font> <font color=Magenta>"let x=1+2; x+x"</font>
  <font color="#808080">,</font> <font color=Magenta>"let p=new 1; let q=new 1738; !(p+1)"</font>
  <font color="#808080">,</font> <font color=Magenta>"!p+1738"</font>
  <font color="#808080">,</font> <font color=Magenta>"(try !p catch 0)+1738"</font>
  <font color="#808080">,</font> <font color=Magenta>"let one = new 1; \
    \let dummy = (try ((one := 2) + !7) catch 0); \
    \!one"</font>
  <font color="#808080">]</font>
exampleRuns <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Either</font> <font color=Green>Err</font> <font color=Green>Integer</font><font color="#808080">]</font>
exampleRuns <font color="#808080">=</font> map run examplePrograms

main <font color="#808080">::</font> <font color=Green>IO</font> <font color=Green>()</font>
main <font color="#808080">=</font> mapM_ print exampleRuns
<font color=Blue>-- For reference:</font>
<font color=Blue>-- &gt; mapM_ f x = sequence_ $ map f x</font>

<font color=Blue>-- --------------</font>

evalP <font color="#808080">::</font> <font color="#808080">(</font> <font color=Green>CMR</font><font color="#800080">.</font><font color=Green>MonadReader</font> <font color=Green>Env</font>   m
         <font color="#808080">,</font> <font color=Green>CMS</font><font color="#800080">.</font><font color=Green>MonadState</font>  <font color=Green>Store</font> m
         <font color="#808080">,</font> <font color=Green>CME</font><font color="#800080">.</font><font color=Green>MonadError</font>  <font color=Green>Err</font>   m
         <font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> m <font color=Green>Value</font>
evalP <font color="#808080">=</font> eval <font color="#800080">.</font> parse


run' <font color="#808080">::</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>Either</font> <font color=Green>Err</font> <font color=Green>Value</font><font color="#808080">,</font> <font color=Green>Either</font> <font color=Green>Err</font> <font color=Green>Value</font><font color="#808080">)</font>
run' s <font color="#808080">=</font> <font color="#808080">(</font> runEval1 <font color="#800080">$</font> evalP s
         <font color="#808080">,</font> runEval2 <font color="#800080">$</font> evalP s
         <font color="#808080">)</font>
</pre>
</body>
</html>