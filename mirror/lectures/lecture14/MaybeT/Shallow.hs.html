<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture14/MaybeT/Shallow.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE GADTs #-}</font>

<u><font color="#804000">module</font></u> <font color=Green>MaybeT</font><font color="#800080">.</font><font color=Green>Shallow</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font><font color="#800080">.</font><font color=Green>Trans</font> <u><font color="#804000">as</font></u> <font color=Green>CMT</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font>       <u><font color="#804000">as</font></u> <font color=Green>CM</font>

<font color=Blue>-- Monad Transformers</font>

<font color=Blue>-- Shallow embedding (nicer)</font>

<font color=Blue>{- A general pattern for defining a monad transformer is

    newtype SomeT pars m a = SomeT
      { runSomeT :: args -&gt; m (something wrapping a) }

That is, a computation in the transformed monad is a computation
in the underlying monad with a more interesting result type,
possibly with some additional arguments.

   From the libraries:
     --        args        "something wrapping a"
     StateT:   s -&gt;      m (a, s)
     ReaderT:  e -&gt;      m a
     WriterT:            m (a, w)
     ErrorT:             m (Either e a)
   -- Reader, Writer and State all at once:
     RWST:     e -&gt; s -&gt; m (a, s, w)
-}</font>
<font color=Blue>-- For our case: no args and "Maybe" wrapping a</font>
<u><font color="#804000">newtype</font></u> <font color=Green>MaybeT</font> m a <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#808080">{</font> runMaybeT <font color="#808080">::</font> m <font color="#808080">(</font><font color=Green>Maybe</font> a<font color="#808080">)</font> <font color="#808080">}</font>

<u><font color="#804000">instance</font></u> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>Monad</font> <font color="#808080">(</font><font color=Green>MaybeT</font> m<font color="#808080">)</font> <u><font color="#804000">where</font></u>
  return <font color="#808080">=</font> returnMT
  <font color="#808080">(</font><font color="#800080">&gt;&gt;=</font><font color="#808080">)</font>  <font color="#808080">=</font> bindMT
  fail   <font color="#808080">=</font> failMT

returnMT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font>  <font color=Green>MaybeT</font> m  a
returnMT x <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> return <font color="#808080">(</font><font color=Green>Just</font> x<font color="#808080">)</font>

bindMT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> <font color=Green>MaybeT</font> m a <font color="#808080">-&gt;</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m b
bindMT m f <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#800080">$</font> <u><font color="#804000">do</font></u> <font color=Blue>-- in the Monad m</font>
  r <font color="#808080">&lt;-</font> runMaybeT m
  <u><font color="#804000">case</font></u> r <u><font color="#804000">of</font></u>
    <font color=Green>Nothing</font> <font color="#808080">-&gt;</font> return <font color=Green>Nothing</font>
    <font color=Green>Just</font> x  <font color="#808080">-&gt;</font> runMaybeT <font color="#808080">(</font>f x<font color="#808080">)</font>

failMT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> t <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m a
failMT <u><font color="#804000">_</font></u> <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#808080">(</font>return <font color=Green>Nothing</font><font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>CMT</font><font color="#800080">.</font><font color=Green>MonadTrans</font> <font color=Green>MaybeT</font> <u><font color="#804000">where</font></u>
  lift <font color="#808080">=</font> liftMT

liftMT <font color="#808080">::</font> <font color=Green>Monad</font> m <font color="#808080">=&gt;</font> m a <font color="#808080">-&gt;</font> <font color=Green>MaybeT</font> m a
liftMT m <font color="#808080">=</font> <font color=Green>MaybeT</font> <font color="#808080">(</font><font color=Green>CM</font><font color="#800080">.</font>liftM <font color=Green>Just</font> m<font color="#808080">)</font>
</pre>
</body>
</html>