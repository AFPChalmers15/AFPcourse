<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture14/Generics.hs</title>
</head>
<body>
<pre><font color=Blue>{-# LANGUAGE DeriveDataTypeable #-}</font>

<u><font color="#804000">import</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Generics</font>
<u><font color="#804000">import</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Set</font> <font color="#808080">(</font><font color=Green>Set</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Set</font> <u><font color="#804000">as</font></u> <font color=Green>Set</font>

<u><font color="#804000">data</font></u> <font color=Green>Expr</font> <font color="#808080">=</font> <font color=Green>Var</font> <font color=Green>Name</font> <font color="#808080">|</font> <font color=Green>App</font> <font color=Green>Expr</font> <font color=Green>Expr</font> <font color="#808080">|</font> <font color=Green>Lam</font> <font color=Green>Name</font> <font color=Green>Expr</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Show</font><font color="#808080">,</font> <font color=Green>Data</font><font color="#808080">,</font> <font color=Green>Typeable</font><font color="#808080">)</font>

<u><font color="#804000">type</font></u> <font color=Green>Name</font> <font color="#808080">=</font> <font color=Green>String</font>

<font color=Blue>-- All the boring cases (just one in this example) can be taken</font>
<font color=Blue>-- care of at once. But gmapQr etc. are complicated and often</font>
<font color=Blue>-- inefficient.  See NoGenerics for a nicer way to do it.</font>
freeVars <font color="#808080">::</font> <font color=Green>Expr</font> <font color="#808080">-&gt;</font> <font color=Green>Set</font> <font color=Green>Name</font>
freeVars <font color="#808080">(</font><font color=Green>Var</font> x<font color="#808080">)</font>   <font color="#808080">=</font> <font color=Green>Set</font><font color="#800080">.</font>singleton x
freeVars <font color="#808080">(</font><font color=Green>Lam</font> x e<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>Set</font><font color="#800080">.</font>delete x <font color="#800080">$</font> freeVars e
freeVars e         <font color="#808080">=</font> gmapQr <font color=Green>Set</font><font color="#800080">.</font>union <font color=Green>Set</font><font color="#800080">.</font>empty 
                            <font color="#808080">(</font>mkQ <font color=Green>Set</font><font color="#800080">.</font>empty freeVars<font color="#808080">)</font> e

<font color=Blue>-- Examples</font>
e1<font color="#808080">,</font> e2<font color="#808080">,</font> e3 <font color="#808080">::</font> <font color=Green>Expr</font>
e1 <font color="#808080">=</font> <font color=Green>Lam</font> <font color=Magenta>"x"</font> <font color="#800080">$</font> <font color=Green>Var</font> <font color=Magenta>"x"</font>
e2 <font color="#808080">=</font> <font color=Green>Lam</font> <font color=Magenta>"unused"</font> <font color="#800080">$</font> <font color=Green>Var</font> <font color=Magenta>"C"</font>
e3 <font color="#808080">=</font> <font color=Green>Lam</font> <font color=Magenta>"x"</font> <font color="#800080">$</font> <font color=Green>Lam</font> <font color=Magenta>"y"</font> <font color="#800080">$</font> <font color=Green>Lam</font> <font color=Magenta>"z"</font> <font color="#800080">$</font> 
     <font color=Green>App</font> <font color="#808080">(</font><font color=Green>Var</font> <font color=Magenta>"x"</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Var</font> <font color=Magenta>"z"</font><font color="#808080">)</font> <font color="#800080">`App`</font> 
     <font color=Green>App</font> <font color="#808080">(</font><font color=Green>Var</font> <font color=Magenta>"y"</font><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>Var</font> <font color=Magenta>"z"</font><font color="#808080">)</font>
</pre>
</body>
</html>