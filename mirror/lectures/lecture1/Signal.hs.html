<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture1/Signal.hs</title>
</head>
<body>
<pre><font color=Blue>-- | A very simple library for manipulating continuous signals.</font>
<u><font color="#804000">module</font></u> <font color=Green>Signal</font>
  <font color="#808080">(</font> <font color=Green>Time</font>
  <font color=Blue>-- | the 'Signal' type is abstract</font>
  <font color="#808080">,</font> <font color=Green>Signal</font>  
  <font color=Blue>-- * Smart constructors</font>
  <font color="#808080">,</font> constS<font color="#808080">,</font> timeS
  <font color=Blue>-- * Combinators</font>
  <font color="#808080">,</font> <font color="#808080">(</font><font color="#800080">$$</font><font color="#808080">)</font><font color="#808080">,</font> mapT
  <font color=Blue>-- * Derived operation</font>
  <font color="#808080">,</font> mapS
  <font color=Blue>-- * Run function</font>
  <font color="#808080">,</font> sample
  <font color="#808080">)</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font> <font color="#808080">(</font>forM_<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Applicative</font><font color="#808080">(</font><font color=Green>Applicative</font><font color="#808080">(</font>pure<font color="#808080">,</font><font color="#808080">(</font><font color="#800080">&lt;*&gt;</font><font color="#808080">)</font><font color="#808080">)</font><font color="#808080">,</font><font color="#808080">(</font><font color="#800080">&lt;$&gt;</font><font color="#808080">)</font><font color="#808080">,</font>liftA2<font color="#808080">)</font>

<font color=Blue>-- * Smart constructors</font>
constS <font color="#808080">::</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a
timeS  <font color="#808080">::</font>      <font color=Green>Signal</font> <font color=Green>Time</font>
<font color=Blue>-- * Combinators</font>
<font color="#808080">(</font><font color="#800080">$$</font><font color="#808080">)</font>   <font color="#808080">::</font> <font color=Green>Signal</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b<font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> b
mapT   <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Time</font> <font color="#808080">-&gt;</font> <font color=Green>Time</font><font color="#808080">)</font>  <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a
<font color=Blue>-- * Derived operation</font>
mapS   <font color="#808080">::</font> <font color="#808080">(</font>a <font color="#808080">-&gt;</font> b<font color="#808080">)</font>        <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> b
<font color=Blue>-- * Run function</font>
sample <font color="#808080">::</font> <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Time</font> <font color="#808080">-&gt;</font> a  

<u><font color="#804000">type</font></u> <font color=Green>Time</font> <font color="#808080">=</font> <font color=Green>Double</font>
<u><font color="#804000">newtype</font></u> <font color=Green>Signal</font> a <font color="#808080">=</font> <font color=Green>Sig</font> <font color="#808080">{</font>unSig <font color="#808080">::</font> <font color=Green>Time</font> <font color="#808080">-&gt;</font> a<font color="#808080">}</font>

<font color=Blue>-- | The constant signal.</font>
constS x <font color="#808080">=</font> <font color=Green>Sig</font> <font color="#808080">(</font>const x<font color="#808080">)</font>

<font color=Blue>-- | The time signal</font>
timeS <font color="#808080">=</font> <font color=Green>Sig</font> id

<font color=Blue>-- | Function application lifted to signals.</font>
fs <font color="#800080">$$</font> xs <font color="#808080">=</font> <font color=Green>Sig</font> <font color="#808080">(</font><font color="#808080">\</font>t <font color="#808080">-&gt;</font> unSig fs t  <font color="#808080">(</font>unSig xs t<font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- | Mapping a function over a signal.</font>
mapS f xs <font color="#808080">=</font> constS f <font color="#800080">$$</font> xs

<font color=Blue>-- | Transforming the time.</font>
mapT f xs <font color="#808080">=</font> <font color=Green>Sig</font> <font color="#808080">(</font>unSig xs <font color="#800080">.</font> f<font color="#808080">)</font>

<font color=Blue>-- | Sampling a signal at a given time point.</font>
<font color=Blue>-- This is the /semantic function/ of our library.</font>
sample <font color="#808080">=</font> unSig

<font color=Blue>--------------------------------------------</font>
<font color=Blue>-- Examples</font>

<font color=Blue>-- | sinusoidal of given frequency</font>
sinS <font color="#808080">::</font> <font color=Green>Double</font> <font color="#808080">-&gt;</font> <font color=Green>Signal</font> <font color=Green>Double</font>
sinS freq <font color="#808080">=</font> mapT <font color="#808080">(</font>freq<font color="#800080">*</font><font color="#808080">)</font> <font color="#800080">$</font> mapS sin timeS

test1 <font color="#808080">::</font> <font color=Green>IO</font> <font color=Green>()</font>
test1 <font color="#808080">=</font> magic <font color="#800080">$</font> sinS <font color=Magenta>0.2</font>

test2 <font color="#808080">::</font> <font color=Green>IO</font> <font color=Green>()</font>
test2 <font color="#808080">=</font> magic <font color="#800080">$</font> <font color="#808080">(</font>avS <font color="#808080">(</font>sinS <font color=Magenta>0.2</font><font color="#808080">)</font> <font color="#808080">(</font>sinS <font color=Magenta>0.1</font><font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- | Problem: averaging two signals?</font>
<font color=Blue>-- @</font>
<font color=Blue>-- averageS :: Fractional a =&gt; </font>
<font color=Blue>--             Signal a -&gt; Signal a -&gt; Signal a</font>
<font color=Blue>-- averageS = -- ... Fill in a definition here ...</font>
<font color=Blue>-- @</font>
<font color=Blue>-- Hint: use the average function, mapS and $$ combinators.</font>
average <font color="#808080">::</font> <font color=Green>Fractional</font> a <font color="#808080">=&gt;</font>  a <font color="#808080">-&gt;</font> a <font color="#808080">-&gt;</font> a
average x y <font color="#808080">=</font> <font color="#808080">(</font>x <font color="#800080">+</font> y<font color="#808080">)</font> <font color="#800080">/</font> <font color=Magenta>2.0</font>

avS xs ys <font color="#808080">=</font> mapS average xs <font color="#800080">$$</font> ys

scale <font color="#808080">::</font> <font color=Green>Num</font> a <font color="#808080">=&gt;</font>  <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a
scale <font color="#808080">=</font> mapS <font color="#808080">(</font><font color="#808080">(</font><font color=Magenta>30</font><font color="#800080">*</font><font color="#808080">)</font> <font color="#800080">.</font> <font color="#808080">(</font><font color=Magenta>1</font><font color="#800080">+</font><font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- | Discretize a signal</font>
discretize <font color="#808080">::</font> <font color=Green>Signal</font> <font color=Green>Double</font> <font color="#808080">-&gt;</font> <font color=Green>Signal</font> <font color=Green>Int</font>
discretize <font color="#808080">=</font> mapS round

<font color=Blue>-- | convert to "analog"</font>
toBars <font color="#808080">::</font> <font color=Green>Signal</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Signal</font> <font color=Green>String</font>
toBars <font color="#808080">=</font> mapS <font color="#808080">(</font><font color="#800080">`replicate`</font> <font color=Magenta>'#'</font><font color="#808080">)</font> 

displayLength <font color="#808080">=</font> <font color=Magenta>100</font>
<font color=Blue>-- | display the signal at a number of points</font>
display <font color="#808080">::</font> <font color=Green>Signal</font> <font color=Green>String</font> <font color="#808080">-&gt;</font> <font color=Green>IO</font> <font color=Green>()</font>
display ss <font color="#808080">=</font> forM_ <font color="#808080">[</font><font color=Magenta>0</font><font color="#808080">..</font>displayLength<font color="#808080">]</font> <font color="#800080">$</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font>
   putStrLn <font color="#808080">(</font>sample ss x<font color="#808080">)</font>

<font color=Blue>-- | The display magic.</font>
<font color=Blue>-- Note how we take advantage of function composition, </font>
<font color=Blue>-- types defined so far, etc.</font>
magic <font color="#808080">::</font> <font color=Green>Signal</font> <font color=Green>Double</font> <font color="#808080">-&gt;</font> <font color=Green>IO</font> <font color=Green>()</font>
magic <font color="#808080">=</font> display <font color="#800080">.</font> toBars <font color="#800080">.</font> discretize <font color="#800080">.</font> scale

<font color=Blue>-- | Signal is an applicative functor</font>
<u><font color="#804000">instance</font></u> <font color=Green>Functor</font> <font color=Green>Signal</font> <u><font color="#804000">where</font></u>
  fmap <font color="#808080">=</font> mapS

<u><font color="#804000">instance</font></u> <font color=Green>Applicative</font> <font color=Green>Signal</font> <u><font color="#804000">where</font></u>
  pure  <font color="#808080">=</font> constS
  <font color="#808080">(</font><font color="#800080">&lt;*&gt;</font><font color="#808080">)</font> <font color="#808080">=</font> <font color="#808080">(</font><font color="#800080">$$</font><font color="#808080">)</font>


<font color=Blue>----------------------------------------------------</font>
<font color=Blue>-- | Answer to exercise</font>
averageS <font color="#808080">::</font> <font color=Green>Fractional</font> a <font color="#808080">=&gt;</font> 
            <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a <font color="#808080">-&gt;</font> <font color=Green>Signal</font> a
averageS xs ys <font color="#808080">=</font> mapS average xs <font color="#800080">$$</font> ys

<font color=Blue>-- | It can also be generalised to an arbitray Applicative functor</font>
averageA <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> a<font color="#808080">,</font> <font color=Green>Applicative</font> f<font color="#808080">)</font> <font color="#808080">=&gt;</font> 
             f a <font color="#808080">-&gt;</font> f a <font color="#808080">-&gt;</font> f a
averageA xs ys <font color="#808080">=</font> average <font color="#800080">&lt;$&gt;</font> xs <font color="#800080">&lt;*&gt;</font> ys
<font color=Blue>-- | or slightly shorter</font>
averageA' <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Fractional</font> a<font color="#808080">,</font> <font color=Green>Applicative</font> f<font color="#808080">)</font> <font color="#808080">=&gt;</font> 
             f a <font color="#808080">-&gt;</font> f a <font color="#808080">-&gt;</font> f a
averageA' <font color="#808080">=</font> liftA2 average

<font color=Blue>-- | Control.Applicative:</font>
<font color=Blue>-- &lt;<a href="http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Applicative.html">http://www.haskell.org/ghc/docs/latest/html/libraries/base/Control-Applicative.html</a>&gt;</font>
</pre>
</body>
</html>