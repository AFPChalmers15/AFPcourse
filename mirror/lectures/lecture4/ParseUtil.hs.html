<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture4/ParseUtil.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>ParseUtil</font> <font color="#808080">(</font><u><font color="#804000">module</font></u> <font color=Green>Parsers</font><font color="#808080">,</font> <u><font color="#804000">module</font></u> <font color=Green>ParseUtil</font><font color="#808080">)</font> <u><font color="#804000">where</font></u>
<u><font color="#804000">import</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>Char</font><font color="#808080">(</font>isDigit<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Parsers</font> <font color=Blue>-- (P, symbol, pfail, (+++), parse)</font>
<font color=Blue>-- import SomeP as Parsers -- you can try with different versions</font>

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Interface:</font>

<font color=Blue>-- | Parse a symbol satisfying a given predicate.</font>
sat <font color="#808080">::</font> <font color="#808080">(</font>s <font color="#808080">-&gt;</font> <font color=Green>Bool</font><font color="#808080">)</font> <font color="#808080">-&gt;</font> <font color=Green>P</font> s s

<font color=Blue>-- | Parse a particular symbol.</font>
this <font color="#808080">::</font> <font color=Green>Eq</font> s <font color="#808080">=&gt;</font> s <font color="#808080">-&gt;</font> <font color=Green>P</font> s s

<font color=Blue>-- | Parse a digit as a number.</font>
digitP <font color="#808080">::</font> <font color=Green>P</font> <font color=Green>Char</font> <font color=Green>Int</font>

<font color=Blue>-- | Parse a left associative operator carefully avoiding left</font>
<font color=Blue>-- recursion.</font>
<font color=Blue>--    chainLeft Op T ::= E</font>
<font color=Blue>--          where E  ::=  E Op T  |  T</font>
chainLeft <font color="#808080">::</font> <font color=Green>P</font> s <font color="#808080">(</font>a <font color="#808080">-&gt;</font> a <font color="#808080">-&gt;</font> a<font color="#808080">)</font>  <font color="#808080">-&gt;</font>  <font color=Green>P</font> s a  <font color="#808080">-&gt;</font>  <font color=Green>P</font> s a

<font color=Blue>----------------------------------------------------------------</font>
<font color=Blue>-- Implementation:</font>
sat p <font color="#808080">=</font> <u><font color="#804000">do</font></u>
  x <font color="#808080">&lt;-</font> symbol
  <u><font color="#804000">if</font></u> p x  <u><font color="#804000">then</font></u>  return x
          <u><font color="#804000">else</font></u>  pfail

this x <font color="#808080">=</font> sat <font color="#808080">(</font>x <font color="#800080">==</font><font color="#808080">)</font>

digitP <font color="#808080">=</font> <u><font color="#804000">do</font></u>
    c <font color="#808080">&lt;-</font> sat isDigit
    return <font color="#808080">(</font>charToInt c<font color="#808080">)</font>
  <u><font color="#804000">where</font></u>
    charToInt c <font color="#808080">=</font> fromEnum c <font color=Blue>-</font> fromEnum <font color=Magenta>'0'</font>

chainLeft op term <font color="#808080">=</font> <u><font color="#804000">do</font></u>
    e <font color="#808080">&lt;-</font> term
    chain e
  <u><font color="#804000">where</font></u>
    chain e <font color="#808080">=</font> return e <font color="#800080">+++</font> <u><font color="#804000">do</font></u>
      o  <font color="#808080">&lt;-</font> op
      e' <font color="#808080">&lt;-</font> term
      chain <font color="#808080">(</font>e <font color="#800080">`o`</font> e'<font color="#808080">)</font>

</pre>
</body>
</html>