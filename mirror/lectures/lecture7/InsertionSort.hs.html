<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture6/InsertionSort.hs</title>
</head>
<body>
<pre><u><font color="#804000">module</font></u> <font color=Green>InsertionSort</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Monad</font>   <u><font color="#804000">as</font></u> <font color=Green>CM</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font> <u><font color="#804000">as</font></u> <font color=Green>Q</font>

q <font color="#808080">::</font> <font color=Green>Q</font><font color="#800080">.</font><font color=Green>Testable</font> prop <font color="#808080">=&gt;</font> prop <font color="#808080">-&gt;</font> <font color=Green>IO</font> <font color=Green>()</font>
q <font color="#808080">=</font> <font color=Green>Q</font><font color="#800080">.</font>quickCheck

<font color=Blue>-- The familiar insert sort function</font>

insert <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>
insert x <font color=Green>[]</font> <font color="#808080">=</font> <font color="#808080">[</font>x<font color="#808080">]</font>
insert x <font color="#808080">(</font>y <b><font color="#800080">:</font></b> xs<font color="#808080">)</font>
  <font color="#808080">|</font> x <font color="#800080">&lt;</font> y     <font color="#808080">=</font> x <b><font color="#800080">:</font></b> y <b><font color="#800080">:</font></b> xs
  <font color="#808080">|</font> otherwise <font color="#808080">=</font> y <b><font color="#800080">:</font></b> insert x xs

sort <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>
sort <font color=Green>[]</font> <font color="#808080">=</font> <font color=Green>[]</font>
sort <font color="#808080">(</font>x <b><font color="#800080">:</font></b> xs<font color="#808080">)</font> <font color="#808080">=</font> insert x <font color="#808080">(</font>sort xs<font color="#808080">)</font>
<font color=Blue>-- or equivalently</font>
<font color=Blue>-- &gt; sort = foldr insert []</font>

<font color=Blue>-- * Properties</font>

<font color=Blue>-- | Checking that a list is ordered.</font>
ordered <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
ordered <font color=Green>[]</font>           <font color="#808080">=</font> <font color=Green>True</font>
ordered <font color="#808080">[</font>x<font color="#808080">]</font>          <font color="#808080">=</font> <font color=Green>True</font>
ordered <font color="#808080">(</font>x <b><font color="#800080">:</font></b> y <b><font color="#800080">:</font></b> xs<font color="#808080">)</font> <font color="#808080">=</font> x <font color="#800080">&lt;=</font> y  <font color="#800080">&amp;&amp;</font>  ordered <font color="#808080">(</font>y <b><font color="#800080">:</font></b> xs<font color="#808080">)</font>

<font color=Blue>-- | 'sort' should produce ordered results.</font>
prop_sort <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>Integer</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
prop_sort xs <font color="#808080">=</font> ordered <font color="#808080">(</font>sort xs<font color="#808080">)</font>

<font color=Blue>-- | 'insert' should preserve orderedness. Bad property!  Why:</font>
<font color=Blue>-- it's quite unlikely that a random longish list will be</font>
<font color=Blue>-- ordered so we will only test very short lists.  'collect'ing</font>
<font color=Blue>-- the lengths of the lists reveal this.</font>
<font color=Blue>--</font>
<font color=Blue>-- Fix (exercise): write a generator for ordered lists.</font>
prop_ins <font color="#808080">::</font> <font color=Green>Integer</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color=Green>Integer</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Q</font><font color="#800080">.</font><font color=Green>Property</font>
prop_ins x xs <font color="#808080">=</font> ordered xs   <font color=Green>Q</font><font color="#800080">.==&gt;</font>
                <font color=Green>Q</font><font color="#800080">.</font>collect <font color="#808080">(</font>length xs<font color="#808080">)</font> <font color="#808080">(</font>ordered <font color="#808080">(</font>insert x xs<font color="#808080">)</font><font color="#808080">)</font>

<font color=Blue>-- How to test properties about how our function treats elements</font>
<font color=Blue>-- it thinks are equal? We define a new type El</font>

<font color=Blue>-- | 'El's are compared only on their keys when sorting.</font>
<u><font color="#804000">type</font></u> <font color=Green>Key</font> <font color="#808080">=</font> <font color=Green>Integer</font>
<u><font color="#804000">type</font></u> <font color=Green>Value</font> <font color="#808080">=</font> <font color=Green>Integer</font>
<u><font color="#804000">data</font></u> <font color=Green>El</font> <font color="#808080">=</font> <font color=Green>El</font> <font color=Green>Key</font> <font color=Green>Value</font>
  <u><font color="#804000">deriving</font></u> <font color="#808080">(</font><font color=Green>Eq</font><font color="#808080">,</font> <font color=Green>Show</font><font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>Ord</font> <font color=Green>El</font> <u><font color="#804000">where</font></u>
  compare <font color="#808080">(</font><font color=Green>El</font> a <u><font color="#804000">_</font></u><font color="#808080">)</font> <font color="#808080">(</font><font color=Green>El</font> b <u><font color="#804000">_</font></u><font color="#808080">)</font> <font color="#808080">=</font> compare a b
  <font color=Blue>-- note that compare x y == EQ   /=   x==y in general</font>

<u><font color="#804000">instance</font></u> <font color=Green>Q</font><font color="#800080">.</font><font color=Green>Arbitrary</font> <font color=Green>El</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> <font color=Green>CM</font><font color="#800080">.</font>liftM2 <font color=Green>El</font> <font color=Green>Q</font><font color="#800080">.</font>arbitrary <font color=Green>Q</font><font color="#800080">.</font>arbitrary

<font color=Blue>-- | Sorting twice is the same as sorting once. Not true for our</font>
<font color=Blue>-- insertion sort!</font>
prop_idem <font color="#808080">::</font> <font color="#808080">[</font><font color=Green>El</font><font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
prop_idem xs <font color="#808080">=</font> sort <font color="#808080">(</font>sort xs<font color="#808080">)</font> <font color="#800080">==</font> sort xs

<font color=Blue>-- What is wrong? (spoiler below)</font>













<font color=Blue>----------------</font>
<font color=Blue>-- A fixed (stable) version uses (&lt;=) in insert</font>
insert' <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> a <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font>
insert' x <font color=Green>[]</font> <font color="#808080">=</font> <font color="#808080">[</font>x<font color="#808080">]</font>
insert' x <font color="#808080">(</font>y<b><font color="#800080">:</font></b>xs<font color="#808080">)</font>
  <font color="#808080">|</font> x <font color="#800080">&lt;=</font> y    <font color="#808080">=</font> x <b><font color="#800080">:</font></b> y <b><font color="#800080">:</font></b> xs
  <font color="#808080">|</font> otherwise <font color="#808080">=</font> y <b><font color="#800080">:</font></b> insert' x xs
</pre>
</body>
</html>