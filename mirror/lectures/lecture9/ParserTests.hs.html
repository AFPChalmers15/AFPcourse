<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<!-- Generated by HsColour, http://code.haskell.org/~malcolm/hscolour/ -->
<title>lectures/lecture9/ParserTests.hs</title>
</head>
<body>
<pre>
<font color=Blue>-- | Testing the parser library from lecture 4.</font>
<u><font color="#804000">module</font></u> <font color=Green>Main</font> <u><font color="#804000">where</font></u>

<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Applicative</font><font color="#808080">(</font><font color="#808080">(</font><font color="#800080">&lt;$&gt;</font><font color="#808080">)</font><font color="#808080">,</font> <font color="#808080">(</font><font color="#800080">&lt;*&gt;</font><font color="#808080">)</font><font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Control</font><font color="#800080">.</font><font color=Green>Arrow</font><font color="#808080">(</font>second<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Data</font><font color="#800080">.</font><font color=Green>List</font><font color="#808080">(</font>sort<font color="#808080">)</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font>
<u><font color="#804000">import</font></u> <font color=Green>Test</font><font color="#800080">.</font><font color=Green>QuickCheck</font><font color="#800080">.</font><font color=Green>Property</font> <font color="#808080">(</font>noShrinking<font color="#808080">)</font>
<font color=Blue>-- import Parsers                   (P, symbol, (+++), pfail, parse)</font>
<u><font color="#804000">import</font></u> <font color=Green>Compiler</font><font color="#800080">.</font><font color=Green>PolyParser</font>                   <font color="#808080">(</font><font color=Green>P</font><font color="#808080">,</font> symbol<font color="#808080">,</font> <font color="#808080">(</font><font color="#800080">+++</font><font color="#808080">)</font><font color="#808080">,</font> pfail<font color="#808080">,</font> parse<font color="#808080">)</font>

<font color=Blue>-- We import the first naive implementation as the specification.</font>
<u><font color="#804000">import</font></u> <u><font color="#804000">qualified</font></u> <font color=Green>Parser1</font> <u><font color="#804000">as</font></u> <font color=Green>Spec</font> <font color="#808080">(</font><font color=Green>P</font><font color="#808080">,</font> symbol<font color="#808080">,</font> <font color="#808080">(</font><font color="#800080">+++</font><font color="#808080">)</font><font color="#808080">,</font> pfail<font color="#808080">,</font> parse<font color="#808080">)</font>

<font color=Blue>-- | We want to generate and show arbitrary parsers. This is tricky</font>
<font color=Blue>-- for a polymorphic type, so to do this we restrict ourselves to</font>
<font color=Blue>-- parsers of type P Bool Bool and build a datatype to model</font>
<font color=Blue>-- these. This type basically captures recognizers of certain patterns</font>
<font color=Blue>-- in raw binary data.</font>
<u><font color="#804000">data</font></u> <font color=Green>ParsBB</font>
  <font color="#808080">=</font> <font color=Green>Plus</font> <font color=Green>ParsBB</font> <font color=Green>ParsBB</font>
  <font color="#808080">|</font> <font color=Green>Fail</font>
  <font color="#808080">|</font> <font color=Green>Return</font> <font color=Green>Bool</font>
  <font color="#808080">|</font> <font color=Green>Symbol</font>
  <font color="#808080">|</font> <font color=Green>Bind</font> <font color=Green>ParsBB</font> <font color=Green>B2ParsBB</font> <font color=Blue>-- the second type is needs to be filled in</font>

<font color=Blue>-- | Instead of arbitrary functions (which quickCheck can generate but</font>
<font color=Blue>-- not check equality of or print) we build a datatype modelling a few</font>
<font color=Blue>-- interesting functions.</font>
<u><font color="#804000">data</font></u> <font color=Green>B2ParsBB</font>
  <font color="#808080">=</font> <font color=Green>K</font> <font color=Green>ParsBB</font>          <font color=Blue>-- \_ -&gt; p</font>
  <font color="#808080">|</font> <font color=Green>If</font> <font color=Green>ParsBB</font> <font color=Green>ParsBB</font>  <font color=Blue>-- \x -&gt; if x then p1 else p2</font>

<font color=Blue>-- Applying a function to an argument.</font>
apply <font color="#808080">::</font> <font color=Green>B2ParsBB</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font> <font color="#808080">-&gt;</font> <font color=Green>ParsBB</font>
apply <font color="#808080">(</font><font color=Green>K</font> p<font color="#808080">)</font>      <u><font color="#804000">_</font></u> <font color="#808080">=</font> p
apply <font color="#808080">(</font><font color=Green>If</font> p1 p2<font color="#808080">)</font> x <font color="#808080">=</font> <u><font color="#804000">if</font></u> x <u><font color="#804000">then</font></u> p1 <u><font color="#804000">else</font></u> p2

<font color=Blue>-- | We can show elements in our model, but not the parsers from the</font>
<font color=Blue>--   implementation.</font>
<u><font color="#804000">instance</font></u> <font color=Green>Show</font> <font color=Green>ParsBB</font> <u><font color="#804000">where</font></u>
  showsPrec n p <font color="#808080">=</font> <u><font color="#804000">case</font></u> p <u><font color="#804000">of</font></u>
    <font color=Green>Fail</font>   <font color="#808080">-&gt;</font> showString <font color=Magenta>"pfail"</font>
    <font color=Green>Symbol</font> <font color="#808080">-&gt;</font> showString <font color=Magenta>"symbol"</font>
    <font color=Green>Return</font> x <font color="#808080">-&gt;</font> showParen <font color="#808080">(</font>n <font color="#800080">&gt;</font> <font color=Magenta>2</font><font color="#808080">)</font> <font color="#800080">$</font> showString <font color=Magenta>"return "</font> <font color="#800080">.</font> shows x
    <font color=Green>Plus</font> p q <font color="#808080">-&gt;</font> showParen <font color="#808080">(</font>n <font color="#800080">&gt;</font> <font color=Magenta>0</font><font color="#808080">)</font> <font color="#800080">$</font> showsPrec <font color=Magenta>1</font> p
                                  <font color="#800080">.</font> showString <font color=Magenta>" +++ "</font>
                                  <font color="#800080">.</font> showsPrec <font color=Magenta>1</font> q
    <font color=Green>Bind</font> p f <font color="#808080">-&gt;</font> showParen <font color="#808080">(</font>n <font color="#800080">&gt;</font> <font color=Magenta>1</font><font color="#808080">)</font> <font color="#800080">$</font> showsPrec <font color=Magenta>2</font> p
                                  <font color="#800080">.</font> showsBind f
    
<font color=Blue>-- | Just to make the output a bit more readable</font>
showsBind <font color="#808080">::</font> <font color=Green>B2ParsBB</font> <font color="#808080">-&gt;</font> <font color=Green>ShowS</font>
showsBind <font color="#808080">(</font><font color=Green>K</font> p2<font color="#808080">)</font> <font color="#808080">=</font> showString <font color=Magenta>" &gt;&gt; "</font> <font color="#800080">.</font> showsPrec <font color=Magenta>1</font> p2
showsBind f      <font color="#808080">=</font> showString <font color=Magenta>" &gt;&gt;= "</font><font color="#800080">.</font> showsPrec <font color=Magenta>1</font> f
    
    
<font color=Blue>-- And we can show our functions. That would have been harder if</font>
<font color=Blue>-- we had used real functions.</font>
<u><font color="#804000">instance</font></u> <font color=Green>Show</font> <font color=Green>B2ParsBB</font> <u><font color="#804000">where</font></u>
  show <font color="#808080">(</font><font color=Green>K</font> p<font color="#808080">)</font>      <font color="#808080">=</font> <font color=Magenta>"\\_ -&gt; "</font> <font color="#800080">++</font> show p
  show <font color="#808080">(</font><font color=Green>If</font> p1 p2<font color="#808080">)</font> <font color="#808080">=</font> <font color=Magenta>"\\x -&gt; if x then "</font> <font color="#800080">++</font> show p1 <font color="#800080">++</font>
                               <font color=Magenta>" else "</font> <font color="#800080">++</font> show p2

<font color=Blue>-- | Generating an arbitrary parser. Parameterised by a size argument</font>
<font color=Blue>--   to ensure that we don't generate infinite parsers.</font>
genParsBB <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Gen</font> <font color=Green>ParsBB</font>
genParsBB <font color=Magenta>0</font> <font color="#808080">=</font> oneof <font color="#808080">[</font> return <font color=Green>Fail</font>
                    <font color="#808080">,</font> <font color=Green>Return</font> <font color="#800080">&lt;$&gt;</font> arbitrary
                    <font color="#808080">,</font> return <font color=Green>Symbol</font> <font color="#808080">]</font>
genParsBB n <font color="#808080">=</font>
  frequency <font color="#800080">$</font>
    <font color="#808080">[</font> <font color="#808080">(</font><font color=Magenta>1</font><font color="#808080">,</font> genParsBB <font color=Magenta>0</font><font color="#808080">)</font>
    <font color="#808080">,</font> <font color="#808080">(</font><font color=Magenta>3</font><font color="#808080">,</font> <font color=Green>Plus</font> <font color="#800080">&lt;$&gt;</font> gen2 <font color="#800080">&lt;*&gt;</font> gen2<font color="#808080">)</font>
    <font color="#808080">,</font> <font color="#808080">(</font><font color=Magenta>5</font><font color="#808080">,</font> <font color=Green>Bind</font> <font color="#800080">&lt;$&gt;</font> gen2 <font color="#800080">&lt;*&gt;</font> genFun2<font color="#808080">)</font>
    <font color="#808080">]</font>
  <u><font color="#804000">where</font></u>
    gen2    <font color="#808080">=</font> genParsBB <font color="#808080">(</font>n <font color="#800080">`div`</font> <font color=Magenta>2</font><font color="#808080">)</font>
    genFun2 <font color="#808080">=</font> genFun <font color="#808080">(</font>n <font color="#800080">`div`</font> <font color=Magenta>2</font><font color="#808080">)</font>

<font color=Blue>-- | Generating arbitrary functions in our model.</font>
genFun <font color="#808080">::</font> <font color=Green>Int</font> <font color="#808080">-&gt;</font> <font color=Green>Gen</font> <font color=Green>B2ParsBB</font>
genFun n <font color="#808080">=</font> oneof <font color="#800080">$</font>
  <font color="#808080">[</font> <font color=Green>K</font>  <font color="#800080">&lt;$&gt;</font> genParsBB n    <font color=Blue>-- ^ Half of our functions are constant</font>
  <font color="#808080">,</font> <font color=Green>If</font> <font color="#800080">&lt;$&gt;</font> gen2 <font color="#800080">&lt;*&gt;</font> gen2
  <font color="#808080">]</font>
  <u><font color="#804000">where</font></u>
    gen2 <font color="#808080">=</font> genParsBB <font color="#808080">(</font>n <font color="#800080">`div`</font> <font color=Magenta>2</font><font color="#808080">)</font>

<u><font color="#804000">instance</font></u> <font color=Green>Arbitrary</font> <font color=Green>ParsBB</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> sized genParsBB

  <font color=Blue>-- Shrinking is used to get minimal counter examples and is very</font>
  <font color=Blue>-- handy.  The shrink function returns a list of things that are</font>
  <font color=Blue>-- smaller (in some way) than the argument.</font>
  shrink <font color="#808080">(</font><font color=Green>Plus</font> p1 p2<font color="#808080">)</font> <font color="#808080">=</font> p1 <b><font color="#800080">:</font></b> p2 <b><font color="#800080">:</font></b>
    <font color="#808080">[</font> <font color=Green>Plus</font> p1' p2 <font color="#808080">|</font> p1' <font color="#808080">&lt;-</font> shrink p1 <font color="#808080">]</font> <font color="#800080">++</font>
    <font color="#808080">[</font> <font color=Green>Plus</font> p1 p2' <font color="#808080">|</font> p2' <font color="#808080">&lt;-</font> shrink p2 <font color="#808080">]</font>
  shrink <font color=Green>Fail</font>         <font color="#808080">=</font> <font color="#808080">[</font> <font color=Green>Return</font> <font color=Green>False</font> <font color="#808080">]</font>
  shrink <font color="#808080">(</font><font color=Green>Return</font> x<font color="#808080">)</font>   <font color="#808080">=</font> <font color=Green>[]</font>
  shrink <font color=Green>Symbol</font>       <font color="#808080">=</font> <font color="#808080">[</font> <font color=Green>Return</font> <font color=Green>False</font> <font color="#808080">]</font>
  shrink <font color="#808080">(</font><font color=Green>Bind</font> p k<font color="#808080">)</font>   <font color="#808080">=</font> p <b><font color="#800080">:</font></b> apply k <font color=Green>False</font> <b><font color="#800080">:</font></b> apply k <font color=Green>True</font> <b><font color="#800080">:</font></b>
    <font color="#808080">[</font> <font color=Green>Bind</font> p' k <font color="#808080">|</font> p' <font color="#808080">&lt;-</font> shrink p <font color="#808080">]</font> <font color="#800080">++</font>
    <font color="#808080">[</font> <font color=Green>Bind</font> p k' <font color="#808080">|</font> k' <font color="#808080">&lt;-</font> shrink k <font color="#808080">]</font>

<u><font color="#804000">instance</font></u> <font color=Green>Arbitrary</font> <font color=Green>B2ParsBB</font> <u><font color="#804000">where</font></u>
  arbitrary <font color="#808080">=</font> sized genFun

  shrink <font color="#808080">(</font><font color=Green>K</font> p<font color="#808080">)</font>      <font color="#808080">=</font> <font color="#808080">[</font> <font color=Green>K</font> p <font color="#808080">|</font> p <font color="#808080">&lt;-</font> shrink p <font color="#808080">]</font>
  shrink <font color="#808080">(</font><font color=Green>If</font> p1 p2<font color="#808080">)</font> <font color="#808080">=</font> <font color=Green>K</font> p1 <b><font color="#800080">:</font></b> <font color=Green>K</font> p2 <b><font color="#800080">:</font></b>
    <font color="#808080">[</font> <font color=Green>If</font> p1 p2 <font color="#808080">|</font> p1 <font color="#808080">&lt;-</font> shrink p1 <font color="#808080">]</font> <font color="#800080">++</font>
    <font color="#808080">[</font> <font color=Green>If</font> p1 p2 <font color="#808080">|</font> p2 <font color="#808080">&lt;-</font> shrink p2 <font color="#808080">]</font>

<font color=Blue>-- | We can turn a parser in our model into its specification...</font>
spec <font color="#808080">::</font> <font color=Green>ParsBB</font> <font color="#808080">-&gt;</font> <font color=Green>Spec</font><font color="#800080">.</font><font color=Green>P</font> <font color=Green>Bool</font> <font color=Green>Bool</font>
spec <font color=Green>Symbol</font>        <font color="#808080">=</font> <font color=Green>Spec</font><font color="#800080">.</font>symbol
spec <font color="#808080">(</font><font color=Green>Return</font> x<font color="#808080">)</font>    <font color="#808080">=</font> return x
spec <font color="#808080">(</font><font color=Green>Plus</font> p1 p2<font color="#808080">)</font>  <font color="#808080">=</font> spec p1   <font color=Green>Spec</font><font color="#800080">.+++</font>   spec p2
spec <font color=Green>Fail</font>          <font color="#808080">=</font> <font color=Green>Spec</font><font color="#800080">.</font>pfail
spec <font color="#808080">(</font><font color=Green>Bind</font> p k<font color="#808080">)</font>    <font color="#808080">=</font> spec p <font color="#800080">&gt;&gt;=</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font> spec <font color="#808080">(</font>apply k x<font color="#808080">)</font>

<font color=Blue>-- | ... or we can compile to a parser from the implementation we're</font>
<font color=Blue>--   testing.</font>
compile <font color="#808080">::</font> <font color=Green>ParsBB</font> <font color="#808080">-&gt;</font> <font color=Green>P</font> <font color=Green>Bool</font> <font color=Green>Bool</font>
compile <font color=Green>Symbol</font>        <font color="#808080">=</font> symbol
compile <font color="#808080">(</font><font color=Green>Return</font> x<font color="#808080">)</font>    <font color="#808080">=</font> return x
compile <font color="#808080">(</font><font color=Green>Plus</font> p1 p2<font color="#808080">)</font>  <font color="#808080">=</font> compile p1 <font color="#800080">+++</font> compile p2
compile <font color=Green>Fail</font>          <font color="#808080">=</font> pfail
compile <font color="#808080">(</font><font color=Green>Bind</font> p k<font color="#808080">)</font>    <font color="#808080">=</font> compile p <font color="#800080">&gt;&gt;=</font> compileFun k

compileFun <font color="#808080">::</font> <font color=Green>B2ParsBB</font> <font color="#808080">-&gt;</font> <font color="#808080">(</font><font color=Green>Bool</font> <font color="#808080">-&gt;</font> <font color=Green>P</font> <font color=Green>Bool</font> <font color=Green>Bool</font><font color="#808080">)</font>
compileFun k <font color="#808080">=</font> <font color="#808080">\</font>x <font color="#808080">-&gt;</font> compile <font color="#808080">(</font>apply k x<font color="#808080">)</font>

<font color=Blue>-- Tests</font>

<u><font color="#804000">infix</font></u> <font color=Magenta>0</font> <font color="#800080">=~=</font>

<font color=Blue>-- | When are two parsers equal? Remember that we don't care</font>
<font color=Blue>--   about the order of results so we sort the result lists</font>
<font color=Blue>--   before comparing.</font>
<font color=Blue>-- (=~=) :: P Bool Bool -&gt; P Bool Bool -&gt; Property</font>
p <font color="#800080">=~=</font> q <font color="#808080">=</font> <font color="#808080">\</font>s <font color="#808080">-&gt;</font> parse p s  <font color="#800080">`bagEq`</font>  parse q s

bagEq <font color="#808080">::</font> <font color=Green>Ord</font> a <font color="#808080">=&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font>a<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
bagEq xs ys <font color="#808080">=</font> sort xs <font color="#800080">==</font> sort ys

<font color=Blue>-- We can turn all the laws we had into properties.</font>
<font color=Blue>-- Exercise: check all the laws L1 .. L10.</font>

law1'' x f <font color="#808080">=</font>   <font color="#808080">(</font>return x <font color="#800080">&gt;&gt;=</font> f<font color="#808080">)</font>   <font color="#800080">==</font>   <font color="#808080">(</font>f x<font color="#808080">)</font>

law1' x f <font color="#808080">=</font>   return x <font color="#800080">&gt;&gt;=</font> f   <font color="#800080">=~=</font>   f x

law1 x f0 <font color="#808080">=</font>   return x <font color="#800080">&gt;&gt;=</font> f   <font color="#800080">=~=</font>   f x
  <u><font color="#804000">where</font></u> f <font color="#808080">=</font> compileFun f0

law2 p0 <font color="#808080">=</font>     p <font color="#800080">&gt;&gt;=</font> return   <font color="#800080">=~=</font>   p
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> compile p0

law3 p0 f0 g0 <font color="#808080">=</font>  <font color="#808080">(</font>p <font color="#800080">&gt;&gt;=</font> f<font color="#808080">)</font> <font color="#800080">&gt;&gt;=</font> g  <font color="#800080">=~=</font>  p <font color="#800080">&gt;&gt;=</font> <font color="#808080">(</font><font color="#808080">\</font>x <font color="#808080">-&gt;</font> f x <font color="#800080">&gt;&gt;=</font> g<font color="#808080">)</font>
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> compile p0
        f <font color="#808080">=</font> compileFun f0
        g <font color="#808080">=</font> compileFun g0

law5 p0 q0 f0 <font color="#808080">=</font>   <font color="#808080">(</font>p <font color="#800080">+++</font> q<font color="#808080">)</font> <font color="#800080">&gt;&gt;=</font> f  <font color="#800080">=~=</font>  <font color="#808080">(</font>p <font color="#800080">&gt;&gt;=</font> f<font color="#808080">)</font> <font color="#800080">+++</font> <font color="#808080">(</font>q <font color="#800080">&gt;&gt;=</font> f<font color="#808080">)</font>
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> compile p0
        q <font color="#808080">=</font> compile q0
        f <font color="#808080">=</font> compileFun f0

law9 p0 q0 <font color="#808080">=</font>      p <font color="#800080">+++</font> q  <font color="#800080">=~=</font>  q <font color="#800080">+++</font> p
  <u><font color="#804000">where</font></u> p <font color="#808080">=</font> compile p0
        q <font color="#808080">=</font> compile q0

<font color=Blue>-- | We can also check that the implementation behaves as the</font>
<font color=Blue>--   specification.</font>
prop_spec p s  <font color="#808080">=</font> <font color=Blue>-- whenFail debug $ </font>
                 lhs  <font color="#800080">`bagEq`</font>  rhs
  <u><font color="#804000">where</font></u>
    lhs <font color="#808080">=</font> parse    <font color="#808080">(</font>compile p<font color="#808080">)</font> s
    rhs <font color="#808080">=</font> <font color=Green>Spec</font><font color="#800080">.</font>parse <font color="#808080">(</font>spec p<font color="#808080">)</font>  s
    debug <font color="#808080">=</font> <u><font color="#804000">do</font></u> putStrLn <font color="#808080">(</font><font color=Magenta>"parse    (compile p) s = "</font> <font color="#800080">++</font> show lhs<font color="#808080">)</font>
               putStrLn <font color="#808080">(</font><font color=Magenta>"Spec.parse (spec p)  s = "</font> <font color="#800080">++</font> show rhs<font color="#808080">)</font>
               putStrLn <font color="#808080">(</font><font color=Magenta>"  where p = "</font> <font color="#800080">++</font> show p<font color="#808080">)</font>
               putStrLn <font color="#808080">(</font><font color=Magenta>"        s = "</font> <font color="#800080">++</font> show s<font color="#808080">)</font>

<font color=Blue>----------------</font>
<font color=Blue>-- | A utility function for turning off shrinking. Only used to</font>
<font color=Blue>-- illustrate the strength of shrinking.</font>
quickCheckNo law <font color="#808080">=</font> quickCheck <font color="#808080">(</font>noShrinking law<font color="#808080">)</font>

<font color=Blue>-- ----------------------------------------------------------------</font>
main <font color="#808080">=</font> <u><font color="#804000">do</font></u>           
  putStrLn <font color=Magenta>"** prop_spec:"</font>
  quickCheckNo prop_spec
<font color=Blue>--  quickCheck prop_spec</font>
  
rest <font color="#808080">=</font> <u><font color="#804000">do</font></u> 
  putStrLn <font color=Magenta>"** Monad law 1:"</font>
  quickCheckNo law1
<font color=Blue>--  quickCheck law1</font>

  putStrLn <font color=Magenta>"** Monad law 2:"</font>
  quickCheckNo law2
<font color=Blue>--  quickCheck law2</font>

  putStrLn <font color=Magenta>"** Monad law 3 (associativity):"</font>
  quickCheckNo law3
<font color=Blue>--  quickCheck law3</font>

  putStrLn <font color=Magenta>"** law5 (dist &gt;&gt;= over +++):"</font>
  quickCheckNo law5
<font color=Blue>--  quickCheck law5</font>

  putStrLn <font color=Magenta>"** law9 (x+y=y+x):"</font>
  quickCheckNo law9
<font color=Blue>--  quickCheck law9</font>



















<font color=Blue>----------------</font>
<font color=Blue>-- Some unfinished experiments below          </font>

language' <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Bounded</font> s<font color="#808080">,</font> <font color=Green>Enum</font> s<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color=Green>P</font> s a <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color="#808080">[</font>s<font color="#808080">]</font><font color="#808080">]</font>
language' p <font color="#808080">=</font> filter <font color="#808080">(</font>parseOK p<font color="#808080">)</font> allLists

language <font color="#808080">::</font> <font color=Green>ParsBB</font> <font color="#808080">-&gt;</font> <font color="#808080">[</font><font color="#808080">[</font><font color=Green>Bool</font><font color="#808080">]</font><font color="#808080">]</font>
language <font color="#808080">=</font> language' <font color="#800080">.</font> compile

parseOK <font color="#808080">::</font> <font color=Green>P</font> s a <font color="#808080">-&gt;</font> <font color="#808080">[</font>s<font color="#808080">]</font> <font color="#808080">-&gt;</font> <font color=Green>Bool</font>
parseOK p <font color="#808080">=</font> not <font color="#800080">.</font> null <font color="#800080">.</font> parse p

allLists <font color="#808080">::</font> <font color="#808080">(</font><font color=Green>Bounded</font> a<font color="#808080">,</font> <font color=Green>Enum</font> a<font color="#808080">)</font> <font color="#808080">=&gt;</font> <font color="#808080">[</font><font color="#808080">[</font>a<font color="#808080">]</font><font color="#808080">]</font>
allLists <font color="#808080">=</font> <font color=Green>[]</font> <b><font color="#800080">:</font></b> <font color="#808080">[</font> x <b><font color="#800080">:</font></b> xs <font color="#808080">|</font> x <font color="#808080">&lt;-</font> allA<font color="#808080">,</font> xs <font color="#808080">&lt;-</font> allLists <font color="#808080">]</font>
  <u><font color="#804000">where</font></u> allA <font color="#808080">=</font> <font color="#808080">[</font>minBound <font color="#808080">..</font> maxBound<font color="#808080">]</font>

test <font color="#808080">=</font> <u><font color="#804000">do</font></u> ps <font color="#808080">&lt;-</font> sample' <font color="#808080">(</font>arbitrary <font color="#808080">::</font> <font color=Green>Gen</font> <font color=Green>ParsBB</font><font color="#808080">)</font>
          return <font color="#800080">$</font> zip ps <font color="#808080">(</font>map language ps<font color="#808080">)</font> 
</pre>
</body>
</html>